'use strict';

const assert = require('assert');
const { inspect } = require('util');

const { mustCall } = require(`${__dirname}/common.js`);

const busboy = require('..');

const input = Buffer.from([
  '-----------------------------paZqsnEHRufoShdX6fh0lUhXBP4k',
 'Content-Disposition: form-data; '
   + 'name="upload_file_0"; filename="テスト.dat"',
 'Content-Type: application/octet-stream',
 '',
 'A'.repeat(1023),
 '-----------------------------paZqsnEHRufoShdX6fh0lUhXBP4k--'
].join('\r\n'));
const boundary = '---------------------------paZqsnEHRufoShdX6fh0lUhXBP4k';
const expected = [
  { type: 'file',
    name: 'upload_file_0',
    data: Buffer.from('A'.repeat(1023)),
    info: {
      filename: 'テスト.dat',
      encoding: '7bit',
      mimeType: 'application/octet-stream',
    },
    limited: false,
  },
];
const bb = busboy({
  defParamCharset: 'utf8',
  headers: {
    'content-type': `multipart/form-data; boundary=${boundary}`,
  }
});
const results = [];

bb.on('field', (name, val, info) => {